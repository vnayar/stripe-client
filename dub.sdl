name "stripe-client"
description "A client library generated from Stripe's OpenAPI specification."
authors "Vijay Nayar"
copyright "Copyright Â© 2022, Vijay Nayar"
license "LGPL"
dependency "openapi-client" version="~>1.1.0"
targetType "library"
targetPath "target"

# The first configuration is used to build the library when used as a dub dependency.
configuration "library" {
}

# To execute integration tests, run: dub test --config=integration
configuration "integration" {
  dependency "silly" version="~>1.2.0-dev.2"
  targetType "library"
  sourcePaths "test"
  # Unless explicitly excluded, the "source" path remains available.
  excludedSourceFiles "*/app.d" "*/main.d"
  importPaths "test"
  # Fire up a stripe-mock server for testing.
  preRunCommands "echo Starting stripe-mock server..." "docker run -d --rm -p 12111-12112:12111-12112 stripe/stripe-mock:latest > containerId.txt" "sleep 1"
  # Terminate the stripe-mock server after testing.
  postRunCommands "echo Stopping stripe-mock server..." "docker stop `cat containerId.txt`" "rm containerId.txt"
}

# To re-create the Stripe API source files (e.g. when the OpenAPI spec changes, run the
# command: dub build --config=generate
configuration "generate" {
  targetType "library"
  preGenerateCommands "dub run openapi-client@1.1.0 -- --targetDir=source --openApiSpec=json/spec3.json --packageRoot=stripe"
}
